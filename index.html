<!DOCTYPE html>
<html>
<head>
    <title>ë¼ë””ì˜¤ëŠ” ì‚¬ì—°ì„ ì‹£ê³ </title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    
    <link rel="icon" type="image/png" href="https://i.imgur.com/xgjafB5.png">
    <link rel="shortcut icon" href="https://i.imgur.com/xgjafB5.png">
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap" rel="stylesheet">
    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>

<style>
    @font-face {
        font-family: 'DungGeunMo';
        src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/DungGeunMo.woff') format('woff');
        font-weight: normal;
        font-style: normal;
        font-display: swap;
    }

    :root {
        --dark-wood: #4B2F2A;
        --mid-wood: #6D4C41;
        --dial-color: #F5DEB3;
        --panel-bg: #88624E;
        --screen-bg: rgba(255, 255, 255, 0.95);
        --font-color: #333;
        --gowun-dodum: 'Gowun Dodum', sans-serif;
        --retro-font: 'DungGeunMo', monospace;
        --error-color: var(--dark-wood);
        --scrollDur: 57s;
    }

    body {
        font-family: var(--gowun-dodum);
        margin: 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        min-height: 100dvh;
        background-color: #f4f4f4;
        transition: background-color 0.5s;
    }

    h1, h2, h3, p, div, span, button, li, table, a, select, textarea, input {
        font-family: var(--gowun-dodum) !important;
    }

    .main-content > p { font-size: 1.1em; }
    .main-content h3 { font-size: 1.3em; font-weight: normal; }

    .radio-wrapper {
        position: relative;
        width: min(95vw, 800px);
        aspect-ratio: 4 / 3;
        max-height: min(85vh, 600px);
        height: auto;
        padding-top: 0;
        box-sizing: content-box;
    }

    .radio-container {
        width: 100%;
        height: 100%;
        background-color: var(--mid-wood);
        border-radius: 20px;
        box-shadow: 0 0 0 15px var(--dark-wood),
                    10px 10px 30px rgba(0, 0, 0, 0.5);
        position: relative;
        display: flex;
        flex-direction: column;
        padding: 20px;
        box-sizing: border-box;
        color: var(--font-color);
        transition: all 0.5s;
        z-index: 10;
    }

    .radio-screen {
        flex: 1;
        background-color: var(--screen-bg);
        border-radius: 5px;
        overflow-y: auto;
        position: relative;
        margin-bottom: 20px;
        height: 100%;
        display: flex;
        flex-direction: column;
        padding: 15px;
    }

    .main-content {
        flex-grow: 1;
        width: 100%;
        display: flex;
        flex-direction: column;
        min-height: 0;
    }

    .main-content h2 {
        border-bottom: 2px solid var(--panel-bg);
        padding-bottom: 10px;
        margin-bottom: 15px;
    }

    .main-content .menu-wrapper {
        display: flex;
        justify-content: space-around;
        gap: 20px;
        width: 100%;
        margin-top: 15px;
    }

    .main-content .menu-item-wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        flex: 1 1 30%;
        min-width: 180px;
        text-align: center;
        margin: 0;
    }

    .main-content .menu-item-wrapper > button {
        width: 100%;
        max-width: 250px;
        padding: 15px 15px !important;
        font-size: 1.1em !important;
        font-weight: normal;
        margin-bottom: 5px;
        border-radius: 8px;
        background-color: var(--dial-color);
        color: var(--dark-wood);
        border: 2px solid var(--panel-bg);
        font-family: var(--gowun-dodum) !important;
    }

    .main-content .menu-item-wrapper > p {
        font-size: 0.85em;
        margin: 0;
        line-height: 1.3;
    }

@media (max-width: 768px), (max-aspect-ratio: 3/4) {
    body {
        padding: 16px 14px;
    }

    .radio-wrapper {
        width: 100%;
        height: 92dvh;
        height: 92svh;
        max-height: 92dvh;
        aspect-ratio: auto;
        padding: 0 12px;
        box-sizing: border-box;
    }

    .radio-container {
        height: 100%;
        grid-template-rows: 6fr 4fr;
        padding: 14px;
        box-shadow: 0 0 0 8px var(--dark-wood), 4px 4px 12px rgba(0,0,0,.4);
    }

    .radio-screen {
        min-height: 0;
        max-height: 100%;
        overflow-y: auto;
        position: relative;       margin-bottom: 10px;
        padding: 10px 10px 12px;
    }

    .control-panel {
        flex-direction: column;
        padding: 10px;
    }

        .control-panel > .dial-control {
            display: none;
        }

        .dial-button-group {
            display: flex !important;
            order: 2;
            width: 100%;
            justify-content: space-around;
            margin-bottom: 10px;
        }

        .dial-button-group .dial-control {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
        }

        .dial-button-group .radio-dial,
        .radio-dial {
            width: 72px;
            height: 72px;
            font-size: .9em;
            margin: 5px auto;
        }

        .frequency-area {
            order: 1;
            width: 95%;
            padding: 5px 0;
        }

        .center-buttons {
            order: 3;
            width: 100%;
            justify-content: space-around;
            margin-top: 10px;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 5px;
        }

        .center-buttons button {
            font-size: 0.9em;
            padding: 10px 5px;
            border-radius: 8px !important;
            min-height: 44px;
        }

        .story-player-area {
            display: flex;
            flex-direction: column;
            height: 100%;
            min-height: 0;
        }

        .story-scroll-container {
            flex: 1 1 auto;
            min-height: 0;
            overflow: hidden;
        }

        .youtube-panel {
            width: 100%;
            min-height: 0;
        }

        .youtube-box {
            height: auto;
            padding: 0;
        }

        .main-content .menu-wrapper {
            flex-direction: column;
            gap: 10px;
        }

        .main-content .menu-item-wrapper {
            width: 100%;
            margin: 5px 0;
        }

        .main-content .menu-item-wrapper > p {
            text-align: left;
        }

        .app-footer {
            display: none;
        }

        @media (max-width: 360px) {
            .qr-size {
                width: 140px !important;
                height: 140px !important;
            }
        }
    }

    #searchResults {
        list-style: none;
        padding: 5px 0 0 0;
        margin: 0;
    }
    #searchResults li {
        padding: 5px 10px;
        border-radius: 5px;
        margin-top: 5px;
        cursor: pointer;
        background-color: rgba(255, 255, 255, 0.7);
        border: 1px dashed var(--panel-bg);
        font-size: 0.9em;
    }
    #searchResults li:hover {
        background-color: var(--dial-color);
    }

    .story-player-area {
        display: flex; 
        flex-grow: 1;
        width: 100%;
        min-height: 300px;
    }

    .scroll-text-box {
        flex: 3; 
        overflow-y: hidden;
        position: relative;
        padding: 10px;
        padding-right: 20px;
        padding-left: 5px;
        border-right: 1px solid #ccc;
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    .story-text-scrolling {
        position: absolute;
        width: 100%;
        color: var(--dark-wood);
        text-align: center;
        top: 100%;
        left: -10px;
        padding: 0 14px;
        white-space: pre-wrap;
        animation: scrollUp var(--scrollDur) linear forwards;
    }

    .story-text-scrolling.size-small { font-size: 1.2em; }
    .story-text-scrolling.size-large { font-size: 2.4em; }

    @keyframes scrollUp {
        0% { transform: translateY(0); }
        100% { transform: translateY(-2000px); }
    }

    .scroll-text-box h2,
    .scroll-text-box p#playerArea {
        flex-shrink: 0;
        margin-top: 5px;
        margin-bottom: 5px;
    }

    .story-scroll-container {
        flex-grow: 1;
        overflow: hidden;
        position: relative;
        padding: 10px 0;
    }

    .youtube-panel {
        flex: 2; 
        display: flex;
        flex-direction: column;
        padding: 10px;
        height: 100%;
    }

    .youtube-box {
        position: relative;
        flex-grow: 1;
        display: flex;
        justify-content: center;
        align-items: flex-end;
        width: 100%;
        aspect-ratio: 16 / 9;
        transition: opacity 0.3s;
    }
    #youtubePlayer,
    #youtubePlayer iframe {
        width: 100%;
        height: 100%;
        max-height: 100%;
        z-index: 1;
        display: block;
    }

    .playback-controls {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 15px;
        flex-wrap: wrap;
    }

.icon-button.is-on {
    background-color: var(--dial-color);
    color: var(--dark-wood);
}

    .icon-button {
        background-color: var(--dark-wood);
        color: var(--dial-color);
        border: 2px solid var(--panel-bg);
        border-radius: 5px;
        width: 40px;
        height: 40px;
        font-size: 1.5em;
        line-height: 1;
        text-align: center;
        cursor: pointer;
        transition: background-color 0.1s;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .icon-button:hover { background-color: #331f1d; }
    .icon-button[title="ëœë¤ ì¬ìƒ"] { font-family: Arial, sans-serif !important; }

    .font-toggle {
        display: inline-flex;
        gap: 6px;
        align-items: center;
        margin-left: 12px;
    }
    .font-btn {
        min-width: 36px;
        height: 36px;
        border: 2px solid var(--panel-bg);
        border-radius: 5px;
        background: #fff;
        color: var(--dark-wood);
        font-weight: 700;
        line-height: 1;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0 8px;
        transition: background-color .15s ease, transform .05s ease;
        font-family: var(--gowun-dodum) !important;
    }
    .font-btn:active { transform: scale(0.98); }
    .font-btn.active { background: var(--dial-color); }

    .form-group { margin-bottom: 15px; }
    .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: var(--dark-wood);
        font-size: 1.1em;
    }

    .form-group input[type="text"],
    .form-group input[type="email"],
    .form-group input[type="password"],
    .form-group textarea,
    .status-select {
        width: 100%;
        padding: 12px;
        font-size: 1.1em;
        font-family: var(--gowun-dodum) !important;
        background-color: var(--dial-color);
        color: var(--dark-wood);
        border: 2px solid var(--panel-bg);
        border-radius: 4px;
        box-sizing: border-box;
    }

    .center-buttons {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
        margin-top: 15px;
        align-self: center;
    }
    .center-buttons button {
        flex-grow: 0;
        width: auto;
        padding: 8px 15px;
        background-color: var(--dial-color);
        color: var(--dark-wood);
        border: 2px solid var(--panel-bg);
        border-radius: 8px;
        font-size: 0.9em;
        font-family: var(--gowun-dodum) !important;
        font-weight: normal;
        cursor: pointer;
    }

    .main-content button[type="submit"],
    .modal-button {
        padding: 10px 20px;
        background-color: var(--dark-wood);
        color: var(--dial-color);
        border: 2px solid var(--panel-bg);
        border-radius: 8px;
        font-size: 1.1em;
        font-weight: normal;
        cursor: pointer;
        transition: background-color 0.1s;
        margin-top: 10px;
        margin-bottom: 20px;
        width: auto;
        display: block;
        margin-left: 0;
        margin-right: auto;
        box-sizing: border-box;
        font-family: var(--gowun-dodum) !important;
    }
    .modal-button {
        width: 100%;
        display: block;
        margin-left: auto;
        margin-right: auto;
        margin-bottom: 0;
    }
    .main-content button[type="submit"]:hover,
    .modal-button:hover { background-color: #331f1d; }

    #writeForm button[type="button"] {
        padding: 8px 15px;
        font-size: 1.1em;
        background-color: var(--panel-bg);
        color: white;
        border-radius: 8px;
        width: auto !important;
        display: inline-block;
        border: none;
        margin-top: 5px;
        font-weight: normal;
        font-family: var(--gowun-dodum) !important;
    }

    .qr-size {
        width: 160px !important;
        height: 160px !important;
        max-width: 160px;
        max-height: 160px;
        background-color: white;
        padding: 10px;
        border: 1px solid #333;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
    }

    .modal-content {
        background-color: var(--screen-bg);
        border: 8px solid var(--dark-wood);
        border-radius: 15px;
        padding: 30px;
        width: min(92vw, 420px);
        text-align: center;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        font-family: var(--gowun-dodum);
    }

    .modal-overlay {
        position: fixed !important;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }
    .modal-overlay.show { display: flex !important; }

    .modal-content h3 {
        color: var(--dark-wood);
        font-size: 1.5em;
        border-bottom: 2px dashed var(--panel-bg);
        padding-bottom: 10px;
        margin-top: 0;
    }
    .modal-content strong {
        color: #d90000;
        font-size: 1.2em;
        display: block;
        padding: 5px 0;
        font-family: var(--gowun-dodum);
        font-weight: normal;
    }

    .control-panel {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background-color: var(--panel-bg);
        border: 2px solid var(--dark-wood);
        border-radius: 5px;
        padding: 15px;
        box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
    }
    .dial-control {
        display: flex;
        flex-direction: column;
        align-items: center;
        flex-shrink: 0;
        width: 100px;
        margin: 0 10px;
    }
    .dial-button-group { display: none; }

    .radio-dial {
        width: 70px;
        height: 70px;
        background-color: var(--dial-color);
        border: 4px solid var(--dark-wood);
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: bold;
        text-align: center;
        cursor: pointer;
        box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3), inset 0 0 3px rgba(0, 0, 0, 0.5);
        transition: all 0.1s;
        padding: 5px;
        box-sizing: border-box;
        line-height: 1.2;
        font-size: 0.85em;
        font-family: var(--gowun-dodum) !important;
    }
    .radio-dial:hover { background-color: #fff8e8; }
    .dummy-dial-label {
        font-size: 0.7em;
        color: var(--dial-color);
        margin-top: 5px;
        text-transform: uppercase;
    }

    .frequency-area {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 0 10px;
    }
    .frequency-display-inner {
        position: relative;
        width: 90%;
        height: 30px;
        background-color: #333;
        border: 1px solid #000;
        border-radius: 3px;
        text-align: center;
        line-height: 30px;
        font-size: 0.9em;
        color: #FFD700;
        font-family: var(--retro-font) !important;
        box-shadow: inset 0 0 5px rgba(255, 215, 0, 0.5);
        overflow: hidden;
    }

    .app-footer {
        margin-top: 20px;
        color: #aaaaaa;
        font-size: 0.8em;
        font-family: var(--gowun-dodum);
    }

    .story-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.9em;
        border: 1px solid #ddd;
    }
    .story-table th,
    .story-table td {
        border: 1px solid #ddd;
        padding: 10px 8px;
        text-align: left;
        font-family: var(--gowun-dodum) !important;
    }
    .story-table td[title] { cursor: help; }

    .button-group button {
        background-color: var(--dark-wood) !important;
        color: white;
        border: none;
        border-radius: 8px;
        padding: 12px 15px !important;
        margin-right: 0 !important;
        width: 100%;
        text-align: center;
        transition: background-color 0.1s;
        font-size: 1.1em;
        font-weight: normal;
        font-family: var(--gowun-dodum) !important;
    }
    .button-group button:hover { background-color: #331f1d !important; }

    .story-table td[class^="status-"] {
        font-weight: 700;
        text-align: center;
        border-left: 4px solid transparent;
        transition: background-color .2s ease, box-shadow .2s ease, color .2s ease;
    }
    .story-table td.status-approved { color: #0f5132; text-shadow: 0 0 6px rgba(25,135,84,0.45); }
    .story-table td.status-pending { color: #664d03; text-shadow: 0 0 6px rgba(255,193,7,0.5); }
    .story-table td.status-rejected { color: #842029; text-shadow: 0 0 6px rgba(220,53,69,0.45); }

    .youtube-box { position: relative; }

    .youtube-box::after {
        content: "";
        position: absolute;
        inset: 0;
        background: rgba(244,244,244,0.99);
        z-index: 2;
        display: grid;
        place-items: center;
        text-align: center;
        font-size: 0.95em;
        color: #333;
        padding: 10px 16px;
        border-radius: 6px;
        transition: opacity .2s ease;
        opacity: 1;
    }

    .youtube-box:hover::after,
    .youtube-box:focus-within::after {
        opacity: 0;
        pointer-events: none;
    }

    @media (hover: none) and (pointer: coarse) {
        .youtube-box::after {
            opacity: 0;
            pointer-events: none;
        }
    }

    .email-error-inline {
        margin-top: 4px;
        color: #c62828;
        font-size: 0.9em;
        display: none;
    }
    .email-error-inline.show {
        display: block;
    }
@media (max-width: 480px) {
    .frequency-area {
        width: 100%;
    }

    .center-buttons {
        display: flex; 
        flex-wrap: nowrap; 
        gap: 6px;
        justify-content: center;
    }

    .center-buttons button {
        flex: 0 1 auto; 
        min-width: 70px;  
        padding: 6px 4px;  
        font-size: 0.78rem; 
        line-height: 1.1;
        border-radius: 6px !important;
    }

    .frequency-display-inner {
        width: 100%;
        margin-bottom: 6px;
    }
}

@media (max-width: 360px) {
    .center-buttons {
        gap: 4px;
    }
    .center-buttons button {
        min-width: 64px;
        font-size: 0.7rem;
        padding: 5px 3px;
    }
}
</style>

</head>
<body>

    <div class="radio-wrapper">
        <div class="radio-container">

            <div class="radio-screen" id="radioScreen">
                <div class="main-content" id="mainContent">
                    <h2 class="content-title">ğŸ“» ë¼ë””ì˜¤ëŠ” ì‚¬ì—°ì„ ì‹£ê³  ğŸ’Œ</h2>
                    <p>ì•„ë˜ ë‹¤ì´ì–¼ì„ ëˆŒëŸ¬ ì›í•˜ëŠ” ê¸°ëŠ¥ì„ ì„ íƒí•˜ì„¸ìš”!</p>
                    <p>ğŸ“ ì‚¬ì—° ì“°ê¸° : ì‚¬ì—°ì„ ì ê³  ì‹ ì²­ê³¡ê³¼ í•¨ê»˜ ë³´ë‚¼ ìˆ˜ ìˆì–´ìš”.</p>
                    <p>ğŸ”‘ ì‚¬ì—° ê´€ë¦¬ : ì±„ë„ì„ ê°œì„¤í•˜ê³  ì‚¬ì—°ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆì–´ìš”.</p>
                </div>
            </div>

            <div class="control-panel">

                <div class="dial-control">
                    <div class="radio-dial" onclick="loadContent('write')">ì‚¬ì—°<br>ì“°ê¸°</div>
                    <div class="dummy-dial-label">VOLUME</div>
                </div>

                <div class="dial-button-group">
                    <div class="dial-control">
                        <div class="radio-dial" onclick="loadContent('write')">ì‚¬ì—°<br>ì“°ê¸°</div>
                        <div class="dummy-dial-label">VOLUME</div>
                    </div>
                    <div class="dial-control">
                        <div class="radio-dial" onclick="loadContent('manage_menu')">ì‚¬ì—°<br>ê´€ë¦¬</div>
                        <div class="dummy-dial-label">TUNING</div>
                    </div>
                </div>

                <div class="frequency-area">
                    <div class="frequency-display-inner" id="frequencyDisplay">
                        ë¼ë””ì˜¤ëŠ” ì‚¬ì—°ì„ ì‹£ê³  - í™˜ì˜í•©ë‹ˆë‹¤!
                    </div>
                    <div class="center-buttons">
                        <button onclick="showQrCode()">QR CODE</button>
                        <button onclick="loadContent('welcome')">HOME</button>
                        <button onclick="goBack()">BACK</button>
                    </div>
                </div>

                <div class="dial-control">
                    <div class="radio-dial" onclick="loadContent('manage_menu')">ì‚¬ì—°<br>ê´€ë¦¬</div>
                    <div class="dummy-dial-label">TUNING</div>
                </div>
            </div>
        </div>
    </div>

    <div class="app-footer">
        Copyright Â© 2025 íœ´ë¥´ìŒ¤. All rights reserved.
    </div>

    <div id="resultModalOverlay" class="modal-overlay" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h3 id="modalTitle">ì±„ë„ ìƒì„± ì™„ë£Œ</h3>
            <p id="modalMessage"></p>
            <p>í•€ ë²ˆí˜¸: <strong id="modalPin"></strong></p>
            <p>ê´€ë¦¬ ë¹„ë°€ë²ˆí˜¸: <strong id="modalPassword"></strong></p>
            <button class="modal-button" onclick="closeModal()">í™•ì¸</button>
        </div>
    </div>
<script>
const WORKER_API_ENDPOINT = 'https://radio.bbglara.workers.dev/';

const mainContent = document.getElementById('mainContent');
const frequencyDisplay = document.getElementById('frequencyDisplay');
const radioScreen = document.getElementById('radioScreen');

let currentChannelPin = null;
let currentChannelName = null;
let managerPassword = null;
let isStorySubmitted = false;

const pageHistory = [];
const MAX_HISTORY_SIZE = 5;


let textSizeMode = 'small'; 
let isRepeatScrolling = false; 

let scrollWatchTimer = null;
const SCROLL_SPEED = 5;     
const MIN_SCROLL_SEC = 8;
const MAX_SCROLL_SEC = 70;

let storyData = []; 
let currentStoryIndex = -1;
let playMode = 'random'; 
let player = null; 

let lastStartedRowNum = null;
let lastStartedStamp = 0;

let loadingInterval = null;

function looksLikeCommonEmailTypo(domain) {
    const obviousTypos = [
        'gmal.com', 'gmai.com', 'gmaii.com', 'gmail.co', 'gmail.con',
        'naver.net', 'nvaer.com', 'naver.co',
        'daum.com',
        'kako.com', 'kakao.co'
    ];
    return obviousTypos.includes(domain);
}

function isEmailAllowed(value) {
    if (!value) return false;
    const t = value.trim();
    const basicPattern = /^[^@]+@[^@]+\.[^@]+$/;
    if (!basicPattern.test(t)) return false;

    const domain = t.split('@')[1].toLowerCase();
    if (looksLikeCommonEmailTypo(domain)) return false;

    const common = [
        'gmail.com', 'naver.com', 'daum.net', 'kakao.com',
        'outlook.com', 'hotmail.com'
    ];
    if (common.includes(domain)) return true;

    const allowEnds = [
        '.kr', '.go.kr', '.or.kr', '.sch.kr', '.es.kr', '.ms.kr', '.hs.kr', '.korea.kr'
    ];
    if (allowEnds.some(sfx => domain.endsWith(sfx))) return true;

    return true;
}

async function callWorker(action, data = {}) {
    try {
        const response = await fetch(WORKER_API_ENDPOINT, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ action, ...data })
        });

        if (!response.ok) {
            const errorBody = await response.json().catch(() => ({ message: 'ì•Œ ìˆ˜ ì—†ëŠ” ì„œë²„ ì‘ë‹µ í˜•ì‹' }));
            throw new Error(`HTTP ${response.status}: ${errorBody.message || response.statusText}`);
        }
        return await response.json();
    } catch (error) {
        console.error('Worker í†µì‹  ì‹¤íŒ¨:', error);
        return { success: false, message: `ì„œë²„ í†µì‹  ì˜¤ë¥˜: ${error.message}` };
    }
}

function startLoadingAnimation(baseMessage) {
    stopLoadingAnimation();
    let dots = 1;
    const loadingTitle = 'loading';
    loadingInterval = setInterval(() => {
        let dotString = '.'.repeat(dots);
        frequencyDisplay.textContent = `[${loadingTitle}] ${baseMessage}${dotString}`;
        dots++;
        if (dots > 3) dots = 1;
    }, 500);
}
function stopLoadingAnimation() {
    if (loadingInterval) {
        clearInterval(loadingInterval);
        loadingInterval = null;
    }
}

function showModal(title, pin, password, emailFailed = false) {
    const msgEl = document.getElementById('modalMessage');
    if (emailFailed) {
        msgEl.innerHTML = 'ì‚¬ì—° ë³´ë‚´ê¸° ë° ê´€ë¦¬ì ë¡œê·¸ì¸ì„ ìœ„í•´<br>ë‹¤ìŒ ì •ë³´ë¥¼ ê¼­ ì €ì¥í•´ ì£¼ì„¸ìš”!<br><br><strong style="color:#c62828;">â€» ì´ë©”ì¼ì´ ë°œì†¡ë˜ì§€ ì•Šì•˜ì–´ìš”. ì•„ë˜ PIN/ë¹„ë²ˆì„ ê¼­ ìº¡ì²˜í•´ ë‘ì„¸ìš”.</strong>';
    } else {
        msgEl.innerHTML = 'ì‚¬ì—° ë³´ë‚´ê¸° ë° ê´€ë¦¬ì ë¡œê·¸ì¸ì„ ìœ„í•´<br>ë‹¤ìŒ ì •ë³´ë¥¼ ê¼­ ì €ì¥í•´ ì£¼ì„¸ìš”!';
    }

    document.getElementById('modalTitle').textContent = title;
    document.getElementById('modalPin').textContent = pin;
    document.getElementById('modalPassword').textContent =
        (password && String(password).trim() !== '')
            ? password
            : '(ì²˜ìŒ ì…ë ¥í•œ 4ìë¦¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”)';
    document.getElementById('resultModalOverlay').classList.add('show');
}
function closeModal() {
    document.getElementById('resultModalOverlay').classList.remove('show');
    loadContent('manage_menu');
}

function initFontToggleListeners() {
    const sm = document.getElementById('fontSmallBtn');
    const lg = document.getElementById('fontLargeBtn');
    if (!sm || !lg) return;
    sm.classList.toggle('active', textSizeMode === 'small');
    lg.classList.toggle('active', textSizeMode === 'large');

    sm.onclick = () => setTextSize('small');
    lg.onclick = () => setTextSize('large');
}
function setTextSize(mode) {
    textSizeMode = (mode === 'large') ? 'large' : 'small';
    const sm = document.getElementById('fontSmallBtn');
    const lg = document.getElementById('fontLargeBtn');
    if (sm && lg) {
        sm.classList.toggle('active', textSizeMode === 'small');
        lg.classList.toggle('active', textSizeMode === 'large');
    }
    applyTextSize(true);
}
function applyTextSize(preserveProgress) {
    const el = document.getElementById('scrollingText');
    if (!el) return;

    let savedTime = null;
    let anim = null;
    if (preserveProgress && el.getAnimations) {
        anim = el.getAnimations()[0];
        if (anim && anim.currentTime != null) savedTime = anim.currentTime;
    }

    el.classList.remove('size-small', 'size-large');
    el.classList.add(textSizeMode === 'large' ? 'size-large' : 'size-small');

    if (savedTime !== null && anim) {
        try { anim.currentTime = savedTime; } catch (e) {}
    }
}

function getChannelTitle(page) {
    switch (page) {
        case 'listen': return 'ON AIR';
        case 'write': return 'ì‚¬ì—° ë³´ë‚´ê¸°';
        case 'manage_menu':
        case 'create_channel':
        case 'login_manage_stories':
        case 'login_listen':
        case 'list_stories':
            return 'ê´€ë¦¬ì';
        case 'qrcode': return 'QR ì½”ë“œ';
        default: return 'ë¼ë””ì˜¤ëŠ” ì‚¬ì—°ì„ ì‹£ê³ ';
    }
}

function loadContent(page, skipHistory = false) {
    let html = '';

    stopLoadingAnimation();

    if (!skipHistory) {
        if (pageHistory.length === 0 || pageHistory[pageHistory.length - 1] !== page) {
            pageHistory.push(page);
            if (pageHistory.length > MAX_HISTORY_SIZE) pageHistory.shift();
        }
        history.replaceState({ page: page }, null, `#${page}`);
    }

    if (page === 'welcome') {
        frequencyDisplay.textContent = 'ë¼ë””ì˜¤ëŠ” ì‚¬ì—°ì„ ì‹£ê³  - í™˜ì˜í•©ë‹ˆë‹¤!';
    } else if (page === 'listen' && currentChannelName) {
        // ì£¼íŒŒìˆ˜ ì°½ ê°„ì†Œí™” (ìµœì‹  ë²„ì „ ë°˜ì˜)
        frequencyDisplay.textContent = `[ON AIR] ì±„ë„: ${currentChannelName}`;
    } else {
        frequencyDisplay.textContent = `[${getChannelTitle(page)}] ì±„ë„`;
    }

    switch (page) {
        case 'welcome':
            html = `
                <h2 class="content-title">ğŸ“» ë¼ë””ì˜¤ëŠ” ì‚¬ì—°ì„ ì‹£ê³  ğŸ’Œ</h2>
                <p>ì•„ë˜ ë‹¤ì´ì–¼ì„ ëˆŒëŸ¬ ì›í•˜ëŠ” ê¸°ëŠ¥ì„ ì„ íƒí•˜ì„¸ìš”!</p>
                <p>ğŸ“ ì‚¬ì—° ì“°ê¸° : ì‚¬ì—°ì„ ì ê³  ì‹ ì²­ê³¡ê³¼ í•¨ê»˜ ë³´ë‚¼ ìˆ˜ ìˆì–´ìš”.</p>
                <p>ğŸ”‘ ì‚¬ì—° ê´€ë¦¬ : ì±„ë„ì„ ê°œì„¤í•˜ê³  ì‚¬ì—°ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆì–´ìš”.</p>
            `;
            break;

        case 'listen':
            if (!currentChannelPin || !currentChannelName) {
                html = `<p style="color: red;">ğŸ¶ ì‚¬ì—° ë³´ê¸°ëŠ” ê´€ë¦¬ì ì±„ë„ ë¡œê·¸ì¸ í›„ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ğŸ”‘</p>`;
            } else {
                html = `
                    <div class="story-player-area">
                        <div class="scroll-text-box">
                            <h2 class="content-title">ğŸ¶ ì‚¬ì—° ë³´ê¸°</h2>
                            <p id="playerArea" style="margin-top: 10px;">ì¬ìƒ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>
                            <div class="story-scroll-container">
                                <p id="scrollingText" class="story-text-scrolling size-${textSizeMode}" style="animation:none; top:100%;"></p>
                            </div>
                        </div>
                        <div class="youtube-panel">
                            <div class="playback-controls">
                                <button id="repeatScrollBtn" class="icon-button ${isRepeatScrolling ? 'is-on' : ''}" title="ì‚¬ì—° ë°˜ë³µ ì¬ìƒ" onclick="toggleRepeatScrolling(this)">&#8634;</button>
                                <button class="icon-button" title="ìˆœì°¨ ì¬ìƒ" onclick="playStories('sequential')">&#9654;</button>
                                <button class="icon-button" title="ëœë¤ ì¬ìƒ" onclick="playStories('random')">&#8644;</button>
                                <div class="font-toggle">
                                    <button id="fontSmallBtn" class="font-btn ${textSizeMode === 'small' ? 'active' : ''}">a</button>
                                    <button id="fontLargeBtn" class="font-btn ${textSizeMode === 'large' ? 'active' : ''}">A</button>
                                </div>
                            </div>
                            <div id="currentStoryInfo"></div>
                            <div class="youtube-box">
                                <div id="youtubePlayer"></div>
                            </div>
                        </div>
                    </div>
                `;
            }
            break;

        case 'write':
        case 'pin_entry':
            html = `
                <h2 class="content-title">ğŸ“ ì‚¬ì—° ì“°ê¸°</h2>
                <form id="pinForm">
                    <div class="form-group">
                        <label for="pin">ì£¼íŒŒìˆ˜ë¥¼ ë§ì¶°ì£¼ì„¸ìš”! (6ìë¦¬ í•€ë²ˆí˜¸)</label>
                        <input type="text" id="pin" maxlength="6" required>
                    </div>
                    <button type="submit">ì±„ë„ ì…ì¥</button>
                </form>
                <div id="writeForm" style="display:none;">
                    <h3 class="content-title" id="channelNameDisplay"></h3>
                    <form id="storyForm">
                        <div class="form-group">
                            <label for="storyName">ì´ë¦„:</label>
                            <input type="text" id="storyName" placeholder="í™ê¸¸ë™" required>
                        </div>
                        <div class="form-group">
                            <label for="storyContent">ì‚¬ì—° ë‚´ìš©:</label>
                            <textarea id="storyContent" rows="4" placeholder="ë³´ë‚´ê³  ì‹¶ì€ ë§ˆìŒì„ ë‹´ì•„ ì£¼ì„¸ìš”."></textarea>
                        </div>
                        <div class="form-group" style="border-bottom: 1px solid #ddd; padding-bottom: 15px;">
                            <label for="searchQuery">ì›í•˜ëŠ” ê³¡ ê²€ìƒ‰ (ê°€ìˆ˜, ì œëª© ìˆœì„œë¡œ ì“°ê¸°):</label>
                            <input type="text" id="searchQuery" placeholder="ì˜ˆ: ìœ¤í•˜, ì‚¬ê±´ì˜ ì§€í‰ì„ " style="margin-bottom: 5px;">
                            <button type="button" onclick="handleSearch()" >ê³¡ ê²€ìƒ‰</button>
                            <ul id="searchResults"></ul>
                        </div>
                        <div class="form-group">
                            <label for="storyUrl">ì„ íƒëœ ìœ íŠœë¸Œ URL (ë˜ëŠ” ì§ì ‘ ì…ë ¥):</label>
                            <input type="text" id="storyUrl" placeholder="ì„ íƒ í›„ ìë™ ì…ë ¥ë©ë‹ˆë‹¤." required>
                        </div>
                        <button type="submit">ì‚¬ì—° ë³´ë‚´ê¸°</button>
                    </form>
                    <p id="submissionStatus" style="margin-top: 15px; color: var(--error-color); font-weight: bold;"></p>
                </div>
            `;
            break;

        case 'manage_menu':
            html = `
                <h2 class="content-title">ğŸ”‘ ê´€ë¦¬ì ë©”ë‰´</h2>
                <div class="menu-wrapper">
                    <div class="menu-item-wrapper">
                        <button onclick="loadContent('create_channel')">ì±„ë„ ë§Œë“¤ê¸°</button>
                        <p>ëª¨ë“  ì‚¬ì—°ì´ ì¬ìƒëœ ì±„ë„ì€ <br> ìì •ì— ìë™ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.</p>
                    </div>
                    <div class="menu-item-wrapper">
                        <button onclick="loadContent('login_manage_stories')">ì‚¬ì—° ê´€ë¦¬ (ìŠ¹ì¸/ê±°ì ˆ)</button>
                        <p>ë¡œê·¸ì¸ í›„ ë„ì°©í•œ ì‚¬ì—°ì„ <br> ìŠ¹ì¸/ê±°ì ˆí•©ë‹ˆë‹¤.</p>
                    </div>
                    <div class="menu-item-wrapper">
                        <button onclick="loadContent('login_listen')">ì‚¬ì—° ë³´ê¸° (ì±„ë„ ì—°ê²°)</button>
                        <p>ë¡œê·¸ì¸ í›„ ìŠ¹ì¸ëœ ì‚¬ì—°ì„ <br> ìˆœì°¨/ëœë¤ ì¬ìƒí•©ë‹ˆë‹¤.</p>
                    </div>
                </div>
            `;
            break;

        case 'create_channel':
            html = `
                <h2 class="content-title">ğŸ› ï¸ ìƒˆ ì±„ë„ ë§Œë“¤ê¸°</h2>
                <form id="createChannelForm">
                    <div class="form-group">
                        <label for="channelName">ì±„ë„ëª…:</label>
                        <input type="text" id="channelName" required>
                    </div>
                    <div class="form-group">
                        <label for="teacherEmail">ì´ë©”ì¼:</label>
                        <input type="email" id="teacherEmail" required>
                        <p id="emailErrorInline" class="email-error-inline">ìœ íš¨í•˜ì§€ ì•Šì€ ì´ë©”ì¼ì…ë‹ˆë‹¤. ì£¼ì†Œë¥¼ ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”.</p>
                    </div>
                    <div class="form-group">
                        <label for="teacherPassword">ë¹„ë°€ë²ˆí˜¸ (4ìë¦¬):</label>
                        <input type="password" id="teacherPassword" maxlength="4" required>
                        <p id="passwordErrorInline" class="email-error-inline">
                            ë¹„ë°€ë²ˆí˜¸ëŠ” ì˜ì–´ ì†Œë¬¸ìì™€ ìˆ«ìë¡œ ëœ 4ê¸€ìë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”.
                        </p>
                    </div>
                    <button type="submit">ì±„ë„ ìƒì„±</button>
                </form>
                <p id="createStatus" style="margin-top: 15px; color: var(--error-color); font-weight: bold;"></p>
            `;
            break;

        case 'login_manage_stories':
        case 'login_listen':
            html = `
                <h2 class="content-title">ğŸ”’ ì‚¬ì—° ${page === 'login_listen' ? 'ë³´ê¸°' : 'ê´€ë¦¬'} ë¡œê·¸ì¸</h2>
                <form id="manageLoginForm">
                    <div class="form-group">
                        <label for="managerPin">ì±„ë„ PIN ë²ˆí˜¸ (6ìë¦¬):</label>
                        <input type="text" id="managerPin" maxlength="6" required>
                    </div>
                    <div class="form-group">
                        <label for="managerPassword">ë¹„ë°€ë²ˆí˜¸ (4ìë¦¬):</label>
                        <input type="password" id="managerPassword" maxlength="4" required>
                    </div>
                    <button type="submit">ë¡œê·¸ì¸ ë° ${page === 'login_listen' ? 'ë“£ê¸°' : 'ëª©ë¡ ë³´ê¸°'}</button>
                </form>
                <p id="manageLoginStatus" style="margin-top: 15px; color: var(--error-color); font-weight: bold;"></p>
            `;
            break;

        case 'list_stories':
            html = `<h2 class="content-title">ğŸ“ [${currentChannelName}] ì‚¬ì—° ëª©ë¡</h2>
                    <div id="storyListArea"><p>ì‚¬ì—° ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p></div>`;
            setTimeout(fetchStoriesForManagement, 50);
            break;

        case 'qrcode':
            html = `
                <h2 class="content-title">ì ‘ì†ìš© QR ì½”ë“œ</h2>
                <div id="qrCodeContainer">
                    <div id="qrcode" class="qr-size"></div>
                </div>
            `;
            setTimeout(generateQrCode, 100);
            break;

        default:
            html = `
                <h2 class="content-title">ğŸ“» ë¼ë””ì˜¤ëŠ” ì‚¬ì—°ì„ ì‹£ê³  ğŸ’Œ</h2>
                <p>ì•„ë˜ ë‹¤ì´ì–¼ì„ ëˆŒëŸ¬ ì›í•˜ëŠ” ê¸°ëŠ¥ì„ ì„ íƒí•˜ì„¸ìš”!</p>
                <p>ğŸ“ ì‚¬ì—° ì“°ê¸° : ì‚¬ì—°ì„ ì ê³  ì‹ ì²­ê³¡ê³¼ í•¨ê»˜ ë³´ë‚¼ ìˆ˜ ìˆì–´ìš”.</p>
                <p>ğŸ”‘ ì‚¬ì—° ê´€ë¦¬ : ì±„ë„ì„ ê°œì„¤í•˜ê³  ì‚¬ì—°ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆì–´ìš”.</p>
            `;
            frequencyDisplay.textContent = 'ë¼ë””ì˜¤ëŠ” ì‚¬ì—°ì„ ì‹£ê³  - í™˜ì˜í•©ë‹ˆë‹¤!';
    }

    mainContent.innerHTML = html;

    if (page === 'listen') {
        setTimeout(() => {
            initFontToggleListeners();
            applyTextSize(false);
            const repeatBtn = document.getElementById('repeatScrollBtn');
            if (repeatBtn) repeatBtn.classList.toggle('is-on', isRepeatScrolling);
        }, 0);
    }

    if (page === 'write' || page === 'pin_entry') {
        setupStoryFormListeners();
    } else if (page === 'create_channel') {
        document.getElementById('createChannelForm').addEventListener('submit', handleCreateChannel);
    } else if (page === 'login_manage_stories' || page === 'login_listen') {
        document.getElementById('manageLoginForm').addEventListener('submit', (e) => handleManageLogin(e, page));
    }
}

function goBack() {
    if (pageHistory.length > 1) {
        pageHistory.pop();
        const previousPage = pageHistory[pageHistory.length - 1];
        loadContent(previousPage, true);
    } else {
        loadContent('welcome', true);
    }
}

function showQrCode() {
    loadContent('qrcode');
    frequencyDisplay.textContent = '[QR CODE] - ì ‘ì† ì£¼íŒŒìˆ˜';
}
function generateQrCode() {
    const url = window.location.href.split('#')[0];
    const qrcodeElement = document.getElementById('qrcode');
    qrcodeElement.innerHTML = '';
    new QRCode(qrcodeElement, {
        text: url,
        width: 160,
        height: 160,
        colorDark : "#000000",
        colorLight : "#ffffff",
        correctLevel : QRCode.CorrectLevel.H
    });
}

async function handleCreateChannel(e) {
    e.preventDefault();

    const btn = e.target.querySelector('button[type="submit"]');
    const createStatus = document.getElementById('createStatus');
    const emailInput = document.getElementById('teacherEmail');
    const emailErrorInline = document.getElementById('emailErrorInline');
    const passwordErrorInline = document.getElementById('passwordErrorInline');

    if (btn) {
        btn.disabled = true;
        btn.textContent = 'ìƒì„± ì¤‘...';
    }

    const channelName = document.getElementById('channelName').value.trim();
    const teacherEmail = emailInput.value.trim();
    const teacherPassword = document.getElementById('teacherPassword').value.trim();

    if (!isEmailAllowed(teacherEmail)) {
        emailErrorInline.textContent = 'ìœ íš¨í•˜ì§€ ì•Šì€ ì´ë©”ì¼ì…ë‹ˆë‹¤. ì£¼ì†Œë¥¼ ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”.';
        emailErrorInline.classList.add('show');
        createStatus.textContent = '';
        if (btn) {
            btn.disabled = false;
            btn.textContent = 'ì±„ë„ ìƒì„±';
        }
        return;
    } else {
        emailErrorInline.classList.remove('show');
    }

    if (!/^[a-z0-9]{4}$/.test(teacherPassword)) {
        passwordErrorInline.textContent = 'ë¹„ë°€ë²ˆí˜¸ëŠ” ì˜ì–´ ì†Œë¬¸ìì™€ ìˆ«ìë¡œ ëœ 4ê¸€ìë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”. ì˜ˆ: ab12, lov3, dj01';
        passwordErrorInline.classList.add('show');
        createStatus.textContent = '';
        if (btn) {
            btn.disabled = false;
            btn.textContent = 'ì±„ë„ ìƒì„±';
        }
        return;
    } else {
        passwordErrorInline.classList.remove('show');
    }

    const pin = Math.floor(100000 + Math.random() * 900000).toString();

    startLoadingAnimation('ì±„ë„ ìƒì„± ì¤‘');
    createStatus.textContent = 'âœ¨ ì±„ë„ ìƒì„± ì¤‘...';

    const res = await callWorker('createChannel', {
        channelName,
        teacherEmail,
        teacherPassword,
        pin
    });

    stopLoadingAnimation();

    if (res.success) {
        const finalPassword = (res.password && String(res.password).trim() !== '')
            ? res.password
            : teacherPassword;

        showModal(
            `${channelName} ì±„ë„ ìƒì„± ì™„ë£ŒğŸ‰`,
            res.pin,
            finalPassword,
            res.emailFailed
        );

        if (res.emailFailed) {
            createStatus.textContent = 'ì±„ë„ì€ ìƒì„±ëì§€ë§Œ ì´ë©”ì¼ ë°œì†¡ì€ ì‹¤íŒ¨í–ˆì–´ìš”. PINì„ ê¼­ ì €ì¥í•´ ë‘ì„¸ìš”!';
        } else {
            createStatus.textContent = '';
        }
    } else {
        createStatus.textContent = res.message;
        createStatus.style.color = 'red';
    }

    if (btn) {
        btn.disabled = false;
        btn.textContent = 'ì±„ë„ ìƒì„±';
    }
}

function setupStoryFormListeners() {
    const pinForm = document.getElementById('pinForm');
    const storyFormContainer = document.getElementById('writeForm');
    const storyForm = document.getElementById('storyForm');

    pinForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const pin = document.getElementById('pin').value;
        const channelNameDisplay = document.getElementById('channelNameDisplay');
        const submissionStatus = document.getElementById('submissionStatus');

        startLoadingAnimation('PIN ê²€ì¦ ì¤‘');
        submissionStatus.textContent = '';

        const res = await callWorker('getChannelInfoByPin', { pin });

        stopLoadingAnimation();

        if (res.success) {
            currentChannelPin = pin;
            currentChannelName = res.channelName;

            pinForm.style.display = 'none';
            storyFormContainer.style.display = 'block';
            frequencyDisplay.textContent = `[${currentChannelName}] ì£¼íŒŒìˆ˜ ì¼ì¹˜!`;

            channelNameDisplay.textContent = `[${currentChannelName}]ì— ì‚¬ì—° ë³´ë‚´ê¸°`;

            if (isStorySubmitted) {
                storyForm.style.display = 'none';
                submissionStatus.textContent = 'ì‚¬ì—°ì€ í•œ ë²ˆë§Œ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
            } else {
                storyForm.style.display = 'block';
                submissionStatus.textContent = '';
            }
        } else {
            submissionStatus.textContent = `ì˜¤ë¥˜: ${res.message}`;
            currentChannelPin = null;
            currentChannelName = null;
        }
    });

    storyForm.addEventListener('submit', handleStorySubmit);
}

async function handleStorySubmit(e) {
    e.preventDefault();

    if (isStorySubmitted || !currentChannelPin) {
        alert('ì±„ë„ ì¸ì¦ì´ í•„ìš”í•˜ê±°ë‚˜ ì´ë¯¸ ì‚¬ì—°ì„ ë³´ëƒˆìŠµë‹ˆë‹¤. ğŸ’¡');
        return;
    }

    const form = document.getElementById('storyForm');
    const submitBtn = form.querySelector('button[type="submit"]');
    if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.textContent = 'ë³´ë‚´ëŠ” ì¤‘...';
    }

    const name = document.getElementById('storyName').value;
    const content = document.getElementById('storyContent').value;
    const url = document.getElementById('storyUrl').value;
    const statusDiv = document.getElementById('submissionStatus');

    startLoadingAnimation('ì‚¬ì—° ë³´ë‚´ëŠ” ì¤‘');
    statusDiv.textContent = 'ë³´ë‚´ëŠ” ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.';

    const res = await callWorker('submitStory', {
        name: name,
        content: content,
        youtubeUrl: url,
        pin: currentChannelPin
    });

    stopLoadingAnimation();

    if (res.success) {
        statusDiv.textContent = 'âœ… ì‚¬ì—°ì„ ë³´ëƒˆìŠµë‹ˆë‹¤! (ìŠ¹ì¸ ëŒ€ê¸° ì¤‘)';
        isStorySubmitted = true;
        form.style.display = 'none';
    } else {
        statusDiv.textContent = `ì˜¤ë¥˜ ë°œìƒ: ${res.message}`;
        if (submitBtn) {
            submitBtn.disabled = false;
            submitBtn.textContent = 'ì‚¬ì—° ë³´ë‚´ê¸°';
        }
    }
}

async function handleManageLogin(e, loginType) {
    e.preventDefault();
    const pin = document.getElementById('managerPin').value;
    const password = document.getElementById('managerPassword').value;
    const loginStatus = document.getElementById('manageLoginStatus');

    startLoadingAnimation('ë¡œê·¸ì¸ ì¤‘');
    loginStatus.textContent = 'ë¡œê·¸ì¸ ì¤‘...';

    const authRes = await callWorker('getAllStories', { pin, password });

    stopLoadingAnimation();

    if (authRes.success || (authRes.message && authRes.message.includes('ë„ì°©í•œ ì‚¬ì—°ì´ ì—†ìŠµë‹ˆë‹¤'))) {
        const channelInfo = await callWorker('getChannelInfoByPin', { pin });
        if (channelInfo.success) {
            currentChannelName = channelInfo.channelName;
            currentChannelPin = pin;
            managerPassword = password;
            loginStatus.textContent = `ë¡œê·¸ì¸ ì„±ê³µ! [${currentChannelName}] ì±„ë„ ì—°ê²° ì™„ë£Œ`;
            setTimeout(() => {
                if (loginType === 'login_listen') {
                    loadContent('listen');
                } else {
                    loadContent('list_stories');
                }
            }, 500);
        } else {
            loginStatus.textContent = `ì¸ì¦ ì‹¤íŒ¨: ${channelInfo.message}`;
        }
    } else {
        loginStatus.textContent = `ì¸ì¦ ì‹¤íŒ¨: ${authRes.message}`;
    }
}

async function fetchStoriesForManagement() {
    if (!currentChannelPin || !managerPassword) {
        document.getElementById('storyListArea').innerHTML = '<p style="color: red;">ì¸ì¦ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”.</p>';
        return;
    }

    const storyListArea = document.getElementById('storyListArea');
    storyListArea.innerHTML = `<p>ì‚¬ì—° ëª©ë¡ì„ ì„œë²„ì—ì„œ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>`;

    startLoadingAnimation('ì‚¬ì—° ëª©ë¡ ë¡œë“œ ì¤‘');

    const res = await callWorker('getAllStories', {
        pin: currentChannelPin,
        password: managerPassword
    });

    stopLoadingAnimation();

    if (res.success) {
        const stories = res.stories;
        if (stories.length === 0) {
            storyListArea.innerHTML = `<p>ì•„ì§ ë„ì°©í•œ ì‚¬ì—°ì´ ì—†ìŠµë‹ˆë‹¤. ğŸ“</p>`;
            return;
        }

        let tableHtml = `
            <form id="bulkUpdateForm">
            <table class="story-table">
                <thead>
                    <tr>
                        <th>ë‚ ì§œ</th>
                        <th>ì´ë¦„</th>
                        <th><span title="ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´ ì „ì²´ ë‚´ìš©ì´ ë³´ì…ë‹ˆë‹¤.">ì‚¬ì—° (ì•ë¶€ë¶„ ì¼ë¶€)</span></th>
                        <th>URL</th>
                        <th>ìƒíƒœ</th>
                        <th>ìŠ¹ì¸/ê±°ì ˆ</th>
                    </tr>
                </thead>
                <tbody>`;

        stories.forEach(story => {
            let statusText = story.status;
            let statusClass;
            // ìµœì‹  ì½”ë“œì˜ ìƒíƒœ í‘œì‹œ ë¡œì§ í†µí•© (isPlayedë¥¼ ëª…ì‹œì ìœ¼ë¡œ í‘œì‹œ)
            statusClass = `status-${story.status.toLowerCase()}`;
            if (story.isPlayed) {
                 statusText += ' (ì™„ë£Œ)';
            }


            const contentSnippet = story.content.length > 15 ? story.content.substring(0, 15) + '...' : story.content;
            const formattedDate = new Date(story.timestamp).toLocaleDateString('ko-KR');

            tableHtml += `
                <tr>
                    <td>${formattedDate}</td>
                    <td>${story.name}</td>
                    <td title="${story.content}" class="story-content-cell">${contentSnippet}</td>
                    <td><a href="${story.youtubeUrl}" target="_blank">ë§í¬</a></td>
                    <td class="${statusClass}">${statusText}</td>
                    <td>
                        <select name="status_${story.rowNum}" data-row="${story.rowNum}" class="status-select">
                            <option value="${story.status}" selected disabled>${story.status}</option>
                            <option value="Approved" ${story.status === 'Approved' ? 'selected' : ''}>ìŠ¹ì¸ (Approved)</option>
                            <option value="Rejected" ${story.status === 'Rejected' ? 'selected' : ''}>ê±°ì ˆ (Rejected)</option>
                            <option value="Pending" ${story.status === 'Pending' ? 'selected' : ''}>ëŒ€ê¸° (Pending)</option>
                        </select>
                    </td>
                </tr>
            `;
        });

        tableHtml += `</tbody></table>
                        <button type="submit" class="button-group" style="margin-top: 15px; background-color: var(--dark-wood); color: var(--dial-color);">ì¼ê´„ ì €ì¥ (ìƒíƒœ ë³€ê²½)</button>
                        </form>`;

        storyListArea.innerHTML = tableHtml;
        document.getElementById('bulkUpdateForm').addEventListener('submit', handleBulkSave);

    } else {
        storyListArea.innerHTML = `<p style="color: red;">ì‚¬ì—° ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤: ${res.message}</p>`;
    }
}

async function handleBulkSave(e) {
    e.preventDefault();
    if (!currentChannelPin || !managerPassword) {
        alert('ì±„ë„ ì¸ì¦ ì •ë³´ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        return;
    }
    if (!confirm('ë³€ê²½ëœ ìƒíƒœë¥¼ ì„œë²„ì— ì¼ê´„ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

    const form = e.target;
    const selectElements = form.querySelectorAll('.status-select');
    const updates = [];
    let isChanged = false;

    selectElements.forEach(select => {
        const initialStatus = select.options[0].value;
        const newStatus = select.value;
        if (initialStatus !== newStatus) {
            updates.push({
                rowNum: parseInt(select.dataset.row),
                newStatus: newStatus
            });
            isChanged = true;
        }
    });

    if (!isChanged) {
        alert('ë³€ê²½ëœ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
        return;
    }

    const saveButton = form.querySelector('button[type="submit"]');
    saveButton.textContent = 'ì €ì¥ ì¤‘...';
    saveButton.disabled = true;

    const res = await callWorker('bulkUpdateStories', {
        pin: currentChannelPin,
        password: managerPassword,
        updates: updates
    });

    if (res.success) {
        alert(res.message);
    } else {
        alert(`ì¼ê´„ ì €ì¥ ì‹¤íŒ¨: ${res.message}`);
    }
    fetchStoriesForManagement();
}

async function playStories(mode) {
    if (!currentChannelPin) {
        alert('ì±„ë„ ì •ë³´ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        return;
    }

    playMode = mode;

    const playerArea = document.querySelector('#mainContent .scroll-text-box #playerArea');
    const storyInfoElement = document.getElementById('currentStoryInfo');
    
    if (playerArea) {
        playerArea.innerHTML = `<p>ì‚¬ì—°ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>`;
    }
    if (storyInfoElement) {
        storyInfoElement.textContent = '';
    }

    startLoadingAnimation('ì‚¬ì—°ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘');

    // ìµœì‹  ì½”ë“œì˜ ë¡œì§ì„ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  ìŠ¤í† ë¦¬ë¥¼ ë¶ˆëŸ¬ì™€ í•„í„°ë§
    const allStoriesRes = await callWorker('getAllStories', { pin: currentChannelPin, password: managerPassword });
    stopLoadingAnimation();

    if (!allStoriesRes.success) {
        mainContent.innerHTML = `<p style="color: red;">ì‚¬ì—°ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤: ${allStoriesRes.message}</p>`;
        return;
    }

    const stories = allStoriesRes.stories || [];
    const approvedStories = stories.filter(s => s.status === 'Approved');
    const pendingStories = stories.filter(s => s.status === 'Pending');
    
    const approvedWithUrl = approvedStories.filter(s => s.youtubeUrl && getYoutubeVideoId(s.youtubeUrl));
    // 1. ì¤‘ë³µ ì¬ìƒ ë°©ì§€ ë¡œì§ ì ìš©
    const unplayedApprovedWithUrl = approvedWithUrl.filter(s => !s.isPlayed); 

    if (approvedWithUrl.length === 0) {
        mainContent.innerHTML = `
            <h2 class="content-title">ğŸ¶ ì‚¬ì—° ì½ê¸°</h2>
            <p>í˜„ì¬ ìŠ¹ì¸ëœ ì‚¬ì—°ì´ ì—†ê±°ë‚˜, ìŠ¹ì¸ëœ ì‚¬ì—°ì— ìœ íš¨í•œ ì‹ ì²­ê³¡ URLì´ ì—†ìŠµë‹ˆë‹¤. ğŸ”‘</p>
        `;
        frequencyDisplay.textContent = 'ìŠ¹ì¸ëœ ì‚¬ì—° ì—†ìŒ';
        return;
    }

    if (unplayedApprovedWithUrl.length === 0) {
        if (pendingStories.length === 0) {
            mainContent.innerHTML = `
                <h2 class="content-title">ğŸ¶ ì‚¬ì—° ì½ê¸°</h2>
                <p>ëª¨ë“  ì‚¬ì—°ì„ ì¬ìƒí–ˆìŠµë‹ˆë‹¤. ğŸ‰ ì±„ë„ì€ ìì •ì— ìë™ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤</p>
            `;
            frequencyDisplay.textContent = 'ëª¨ë“  ì‚¬ì—° ì¬ìƒ ì™„ë£Œ';
            return;
        }
        else {
            mainContent.innerHTML = `
                <h2 class="content-title">ğŸ¶ ì‚¬ì—° ì½ê¸°</h2>
                <p>ìŠ¹ì¸ëœ ì‚¬ì—°ì´ ëª¨ë‘ ì¬ìƒë˜ì—ˆìŠµë‹ˆë‹¤. <br>ëŒ€ê¸° ì¤‘ì¸ ì‚¬ì—° (${pendingStories.length}ê°œ)ì´ ìˆìŠµë‹ˆë‹¤. <br>ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ì‚¬ì—°ì„ ìŠ¹ì¸í•´ ì£¼ì„¸ìš”.</p>
            `;
            frequencyDisplay.textContent = `ëŒ€ê¸° ì‚¬ì—° (${pendingStories.length}) í™•ì¸ í•„ìš”`;
            return;
        }
    }

    storyData = unplayedApprovedWithUrl;
    
    if (playMode === 'sequential') {
        storyData.sort((a, b) => new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime());
        currentStoryIndex = 0;
    } else {
        shuffleArray(storyData);
        currentStoryIndex = 0;
    }

    loadContent('listen', true);

    setTimeout(() => {
        initFontToggleListeners();
        applyTextSize(false);
        const repeatBtn = document.getElementById('repeatScrollBtn');
        if (repeatBtn) {
            repeatBtn.classList.toggle('is-on', isRepeatScrolling);
        }
    }, 0);

    loadYoutubeAPI();
}

function shuffleArray(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
}

function loadYoutubeAPI() {
    if (typeof YT === 'undefined' || typeof YT.Player === 'undefined') {
        const tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        const firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;
    } else {
        onYouTubeIframeAPIReady();
    }
}

function onYouTubeIframeAPIReady() {
    const youtubeBox = document.getElementById('youtubePlayer');
    if (!youtubeBox) {
        console.error("YouTube Player DOM element not found.");
        return;
    }

    player = new YT.Player('youtubePlayer', {
        height: '100%',
        width: '100%',
        playerVars: {
            'rel': 0,
            'modestbranding': 1,
            'autoplay': 1,
            'disablekb': 1,
            'iv_load_policy': 3, // 3. ê´‘ê³  ìµœì†Œí™” ì˜µì…˜ ì ìš© (ì¸í¬ ì¹´ë“œ ë¹„í™œì„±í™”)
            'showinfo': 0,
            'cc_load_policy': 0
        },
        events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
        }
    });
}

function onPlayerReady() {
    playNextStory();
}

function onPlayerStateChange(event) {
    if (event.data === 1) { 
        if (currentStoryIndex !== -1 && storyData[currentStoryIndex]) {
            const story = storyData[currentStoryIndex];

            const now = Date.now();
            if (lastStartedRowNum !== story.rowNum || (now - lastStartedStamp) > 2000) {
                lastStartedRowNum = story.rowNum;
                lastStartedStamp = now;

                (async () => {
                    try {
                        await callWorker('setStoryStarted', {
                            pin: currentChannelPin,
                            rowNum: story.rowNum,
                            startedAt: now
                        });
                    } catch (e) {
                        console.warn('ì¬ìƒ ì‹œì‘ ì²´í¬ ì‹¤íŒ¨(ë¬´ì‹œ):', e);
                    }
                })();
            }
             // 2. ê°„ì†Œí™”ëœ ì¬ìƒ ì •ë³´ í‘œì‹œ (ì´ì „ ë³µì¡í•œ ì¹´ìš´íŠ¸ ì‚­ì œ)
            const storyInfoElement = document.getElementById('currentStoryInfo');
            if (storyInfoElement) {
                 storyInfoElement.textContent = playMode === 'random' ? 'ëœë¤ìœ¼ë¡œ ì¬ìƒí•˜ëŠ” ì¤‘' : 'ìˆœì„œëŒ€ë¡œ ì¬ìƒí•˜ëŠ” ì¤‘';
            }
        }
    }

    if (event.data === 0) { 
        if (currentStoryIndex !== -1 && storyData[currentStoryIndex]) {
            const story = storyData[currentStoryIndex];

            callWorker('setStoryPlayed', {
                pin: currentChannelPin,
                rowNum: story.rowNum
            }).catch(err => {
                console.warn('[Playback] setStoryPlayed failed (ignored):', err);
            });

            // playedCount++ ì œê±° (ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ)

            // 1. ì¤‘ë³µ ì¬ìƒ ë°©ì§€ ë¡œì§: ì¬ìƒ ì™„ë£Œ í›„ ëª©ë¡ì—ì„œ ì œê±°
            storyData.splice(currentStoryIndex, 1);
            currentStoryIndex = -1;

            playNextStory();
        } else {
            playNextStory();
        }
    }
}

function playNextStory() {
    const storyInfoElement = document.getElementById('currentStoryInfo');
    const playerArea = document.getElementById('playerArea');

    if (storyData.length === 0) {
        if (playerArea) {
             playerArea.innerHTML = `<p>ë‹¤ìŒ ì‚¬ì—°ì´ ì—†ìŠµë‹ˆë‹¤. <br>ì¬ìƒ ë²„íŠ¼ì„ ë‹¤ì‹œ ëˆŒëŸ¬ ìƒíƒœë¥¼ ê°±ì‹ í•´ ì£¼ì„¸ìš”.</p>`;
        }
        frequencyDisplay.textContent = 'ì¬ìƒ ëª©ë¡ ì¢…ë£Œ';
        if (storyInfoElement) {
             storyInfoElement.textContent = `ëª¨ë“  ì‚¬ì—° ì¬ìƒ ì™„ë£Œ`;
        }
        if (player) player.stopVideo();
        return;
    }

    // 1. ì¤‘ë³µ ì¬ìƒ ë°©ì§€ ë¡œì§: í•­ìƒ ëª©ë¡ì˜ 0ë²ˆì§¸ ì¬ìƒ í›„ ì œê±°
    currentStoryIndex = 0; 

    const story = storyData[currentStoryIndex];
    const videoId = getYoutubeVideoId(story.youtubeUrl);

    if (videoId && player) {
        player.loadVideoById(videoId);

        // 2. ê°„ì†Œí™”ëœ ì£¼íŒŒìˆ˜ ì°½ í‘œì‹œ
        frequencyDisplay.textContent = `ON AIR: ${story.name} ë‹˜ì˜ ì‚¬ì—° (ì±„ë„: ${currentChannelName})`;

        const scrollingText = document.getElementById('scrollingText');
        // ì‚¬ì—° ì°½ì— ì‚¬ì—° ì™¸ ë¬¸êµ¬ ì œê±° (ìµœì‹  ì½”ë“œ ë°˜ì˜)
        scrollingText.textContent = `[${story.name} ë‹˜ì˜ ì‚¬ì—°]\n${story.content}`;

        // 2. ê°„ì†Œí™”ëœ ì¬ìƒ ì •ë³´ í‘œì‹œ
        if (storyInfoElement) {
             storyInfoElement.textContent = playMode === 'random' ? 'ëœë¤ìœ¼ë¡œ ì¬ìƒí•˜ëŠ” ì¤‘' : 'ìˆœì„œëŒ€ë¡œ ì¬ìƒí•˜ëŠ” ì¤‘';
        }
        
        if (playerArea) {
             playerArea.innerHTML = ``; 
        }

        restartCurrentScrolling();
    } else {
        console.error('ìœ íš¨í•˜ì§€ ì•Šì€ YouTube URL ë˜ëŠ” ID: ', story.youtubeUrl);
        storyData.splice(currentStoryIndex, 1);
        currentStoryIndex = -1;
        playNextStory();
    }
}

function toggleRepeatScrolling(btn) {
    isRepeatScrolling = !isRepeatScrolling;
    if (btn) {
        btn.classList.toggle('is-on', isRepeatScrolling);
    }
    if (isRepeatScrolling) {
        restartCurrentScrolling();
    } else {
        if (scrollWatchTimer) {
            clearInterval(scrollWatchTimer);
            scrollWatchTimer = null;
        }
    }
}

function restartCurrentScrolling() {
    const el = document.getElementById('scrollingText');
    if (!el) return;

    el.style.animation = 'none';
    el.style.top = '100%';
    el.style.animationDelay = '0s';

    setTimeout(() => {
        el.classList.remove('size-small', 'size-large');
        el.classList.add(textSizeMode === 'large' ? 'size-large' : 'size-small');

        setScrollAnimationDuration(el);
        applyTextSize(false);

        startScrollWatcher();
    }, 50);
}

function setScrollAnimationDuration(el) {
    const container = el.parentElement;
    if (!container) return;

    const boxHeight = container.getBoundingClientRect().height;
    const textHeight = el.getBoundingClientRect().height;

    let scrollDistance = textHeight + boxHeight + 40; 

    let durationSec = scrollDistance / SCROLL_SPEED;
    if (durationSec < MIN_SCROLL_SEC) durationSec = MIN_SCROLL_SEC;
    if (durationSec > MAX_SCROLL_SEC) durationSec = MAX_SCROLL_SEC;

    el.style.setProperty('--scrollDur', `${durationSec}s`); 
    el.style.animation = `scrollUp ${durationSec}s linear forwards`;
}

function startScrollWatcher() {
    if (scrollWatchTimer) {
        clearInterval(scrollWatchTimer);
        scrollWatchTimer = null;
    }

    const el = document.getElementById('scrollingText');
    if (!el) return;

    scrollWatchTimer = setInterval(() => {
        if (!isRepeatScrolling) {
            clearInterval(scrollWatchTimer);
            scrollWatchTimer = null;
            return;
        }
        const container = el.parentElement;
        if (!container) return;

        const elRect = el.getBoundingClientRect();
        const boxRect = container.getBoundingClientRect();

        const isOut = elRect.bottom < boxRect.top;

        if (isOut) {
            clearInterval(scrollWatchTimer);
            scrollWatchTimer = null;
            setTimeout(() => {
                if (isRepeatScrolling) {
                    restartCurrentScrolling();
                }
            }, 1200); 
        }
    }, 400);
}

document.addEventListener('animationend', function (e) {
    if (e.target && e.target.id === 'scrollingText') {
        if (isRepeatScrolling) {
            setTimeout(() => {
                if (isRepeatScrolling) {
                    restartCurrentScrolling();
                }
            }, 1200);
        }
    }
});

function getYoutubeVideoId(url) {
    if (!url) return null;
    const match = url.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|\w+\/|watch\?v=)|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})/);
    if (match && match[1]) return match[1];
    try {
        const u = new URL(url, window.location.origin);
        const v = u.searchParams.get('v');
        if (v && v.length === 11) return v;
    } catch (e) {}
    return null;
}

let searchResultsData = [];

async function handleSearch() {
    const queryInput = document.getElementById('searchQuery');
    const query = queryInput.value.trim();
    const resultsContainer = document.getElementById('searchResults');
    const storyUrlInput = document.getElementById('storyUrl');

    if (query.length < 2) {
        resultsContainer.innerHTML = '<li>ê²€ìƒ‰ì–´ë¥¼ ë‘ ê¸€ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.</li>';
        return;
    }

    resultsContainer.innerHTML = '<li>ê²€ìƒ‰ ì¤‘ì…ë‹ˆë‹¤...</li>';

    startLoadingAnimation('YouTube ê²€ìƒ‰ ì¤‘');

    const res = await callWorker('searchYoutube', { query: query });

    stopLoadingAnimation();

    if (res.success && res.results.length > 0) {
        searchResultsData = res.results;
        let html = '';
        res.results.forEach((item, index) => {
            html += `<li onclick="selectSong(${index})">ğŸµ ${item.title}</li>`;
        });
        resultsContainer.innerHTML = html;
    } else {
        resultsContainer.innerHTML = `<li>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. URLì„ ì§ì ‘ ì…ë ¥í•˜ê±°ë‚˜ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.</li>`;
        storyUrlInput.value = '';
    }
}

function selectSong(index) {
    const selected = searchResultsData[index];
    const storyUrlInput = document.getElementById('storyUrl');
    const resultsContainer = document.getElementById('searchResults');
    storyUrlInput.value = selected.url;
    resultsContainer.innerHTML = `<li>âœ… ${selected.title} ì„ íƒ ì™„ë£Œ!</li>`;
}

window.onload = () => {
    loadContent('welcome');
};
</script>
</body>
</html>
